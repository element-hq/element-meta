name: Sync labels
on:
  workflow_dispatch: {}
  push:
    branches:
      - develop
    paths:
      - .github/labels.yml
  workflow_call:
    inputs:
      LABELS:
        description: |
          List of paths to YAML files, one per line, in the format specified in
          https://github.com/Financial-Times/github-label-sync#label-config-file".
          The files will merge/override the local YAML file in order.
        type: string
        required: true
    secrets:
      ELEMENT_BOT_TOKEN:
        description: Sufficiently privileged GitHub token
        required: true
jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Check out calling repository
        uses: actions/checkout@v4
        if: github.repository != 'vector-im/element-meta'
      - name: Check out vector-im/element-meta
        uses: actions/checkout@v4
        with:
          path: element-meta
          repository: vector-im/element-meta
      - name: "Set up Node.js"
        uses: actions/setup-node@v4
        with:
          cache: yarn
      - name: "Sync labels"
        run: "yarn sync-labels --labels labels.yml $(echo -e \"${{ inputs.LABELS }}\" | xargs printf -- '--labels \"../%s\"\n' | xargs echo)"
        working-directory: element-meta
        env:
          GITHUB_TOKEN: ${{ secrets.ELEMENT_BOT_TOKEN }}
          GITHUB_REPOSITORY: ${{ github.repository }}
